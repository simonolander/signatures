#!/bin/python
from multiprocessing import Pool

import storage
from hidden_signature import *
import numpy as np

# Read data

data = storage.get_cleaned_data()

hid = np.array([[2877.01912698, 5572.15595238, 8.75, 437.16519841],
                [3000.35, 5723.45, 25.75, 476.],
                [3087.86666667, 5819.01666667, 34., 493.18333333],
                [3182.5, 5896.4, 41.5, 502.4],
                [3281.55, 5928.35, 48.5, 519.25],
                [3357.15, 5926.15, 55., 534.6],
                [3435.4, 5911.5, 62., 547.6],
                [3536.7, 5938., 69.5, 564.35],
                [3642.4, 5979.25, 76., 576.95],
                [3797.275, 5987.655, 85.25, 584.68333333],
                [3871.05, 5809.95, 101.05, 599.75],
                [3941.475, 5692.325, 109.55, 585.75],
                [4011.26818182, 5539.16818182, 122.64090909, 541.24545455],
                [3902.75, 5146.45, 149.05, 555.1],
                [3828., 4781.85, 161.05, 605.15],
                [3808.1, 4482.05, 171.05, 625.2],
                [3788.85, 4235.4, 180.55, 637.05],
                [3785.75, 4052.2, 190.55, 617.65],
                [3755.49166667, 3939.425, 203.85, 630.85],
                [3767.21333333, 3814.07833333, 219.35, 512.07],
                [3324.68547619, 4241.39702381, 306.3, 575.06],
                [3572.525, 4420.7, 323.55, 584.925],
                [3748.1, 4508.3, 333.3, 550.35],
                [3900.95, 4612.1, 351.8, 562.2],
                [3935.025, 4623.925, 364.65, 607.675],
                [3967.15, 4588.55, 370.45, 613.9],
                [4007.85, 4564., 375.95, 614.65],
                [4096.375, 4508.7, 384.7, 617.525],
                [4137.8, 4385.425, 393.2, 612.075],
                [4151.45, 4231.7, 401.95, 587.35],
                [4125.8, 4013.4, 413.45, 572.75],
                [4100.4, 3897.875, 419.7, 577.05],
                [3993.5, 3620.65, 436.95, 600.85],
                [3840.8, 3347.85, 454., 645.55],
                [3727.95, 3182.15, 462.5, 669.3],
                [3648.75, 3029.65, 471.5, 693.35],
                [3597.2, 2926.75, 480., 709.4],
                [3544.01357143, 2828.62619048, 494.04285714, 741.69166667],
                [3639.7, 2825.05, 509.05, 773.65],
                [3835.3, 2894.85, 519.05, 779.55],
                [4032.1, 2968.6, 527.3, 780.],
                [4307.525, 3085.7, 536.85, 754.225],
                [4596., 3205.55, 545.6, 697.7],
                [4949.43333333, 3414.79166667, 560.65, 578.84166667],
                [5682.1, 4248.65, 620.85, 516.],
                [6780.75, 5532.9, 741.6, 572.75],
                [6825.2, 5579.95, 750.6, 589.45],
                [6829.55, 5600.49166667, 761.6, 598.225],
                [6837.3, 5505.75, 770.6, 619.35],
                [6846.85, 5298.55, 779.85, 640.875],
                [6850.8, 5005.8, 789.6, 653.8],
                [6848.95, 4624.65, 799.6, 659.95],
                [6833.5, 4252.95, 808.6, 659.7],
                [6812.875, 3945.375, 817.9, 655.95],
                [6785.6, 3684.25, 827.15, 645.5],
                [6757.1875, 3497.175, 837.65, 610.4],
                [6720.56666667, 3379.99166667, 847.65, 536.10833333],
                [6658.24166667, 3405.4, 863.175, 259.25833333],
                [6568.425, 5202.18333333, 938.925, 453.825],
                [6811.2, 5651.45, 949.3, 504.05],
                [7000.75, 5953.3, 958.8, 552.05],
                [7175.4, 6225.05, 968.8, 589.4],
                [7332.4, 6391.5, 977.3, 612.75],
                [7473.5, 6493.7, 985.3, 632.85],
                [7634.35, 6532.95, 994.8, 658.],
                [7786.41666667, 6481.83333333, 1004.85, 686.51666667],
                [7922.175, 6275.5, 1016.85, 719.65],
                [8014.15, 5948.65, 1028.1, 755.15],
                [8063.975, 5514.825, 1039.1, 789.225],
                [8079.45, 5137.25, 1046.9, 809.8],
                [8080.3, 4637.875, 1056.65, 829.8],
                [8071.95, 4141.1, 1066.9, 840.6],
                [8065.85, 3745.15, 1076.9, 859.4],
                [8058.75, 3475.7, 1086.4, 864.2],
                [8047.9, 3288.25, 1094.9, 864.95],
                [8034.025, 3134.5, 1103.4, 866.575],
                [7999.65083333, 2974.5575, 1116.65, 844.71666667],
                [7909.95, 2947., 1131.4, 700.3],
                [7690.65, 3078.85, 1145.5, 416.95],
                [5768.28, 3998.87, 1235.47, 567.68],
                [5717.925, 3957.35, 1244.75, 621.125],
                [5751.5, 4054.2, 1253., 654.075],
                [5896.4, 4166.75, 1261.75, 684.5],
                [6120.4, 4287.85, 1270.75, 709.95],
                [6488.7, 4415.9, 1280.25, 723.25],
                [6955.8, 4532.15, 1290.25, 735.25],
                [7424.65, 4628.1, 1299.75, 733.9],
                [7831.35, 4699.05, 1308.75, 703.9],
                [8168.425, 4752.425, 1317.05, 676.025],
                [8485.79333333, 4801.16083333, 1329.05, 607.41583333],
                [8500., 4945.9, 1353.8, 309.45],
                [7526.05, 5548.575, 1426.85, 537.325],
                [7380.525, 5365.675, 1437.1, 587.95],
                [7321.75, 5315., 1447.1, 594.3],
                [7297.65, 5260.35, 1457.15, 569.3],
                [7305., 5137.25, 1465.9, 400.3]])

rmse = np.array([[654.06528701, 438.50586285, 11.92424002, 91.89271634],
                  [546.17801814, 403.14134928, 25.55753314, 75.9993421],
                  [492.18624975, 424.67180105, 28., 70.70293684],
                  [445.99815022, 432.99161655, 29.87892234, 71.79512518],
                  [401.68700191, 452.62249999, 32.13642793, 68.50246346],
                  [360.99117371, 455.21701144, 31.70173497, 63.23559124],
                  [330.55595593, 431.71350454, 31.8747549, 62.03418412],
                  [317.37392773, 392.82667934, 32.32259272, 60.85990059],
                  [328.92315212, 362.87875041, 31.84336666, 59.27855852],
                  [397.09897757, 348.02994974, 31.60201734, 74.85255692],
                  [443.30942636, 188.9831937, 37.92027822, 88.67461587],
                  [504.25810541, 177.4887514, 37.96508264, 130.67244354],
                  [541.33258401, 160.34463213, 48.82124144, 220.39940848],
                  [474.45198651, 256.96818383, 63.51493919, 235.86159077],
                  [386.1609768, 297.76891628, 62.56154969, 163.9641043],
                  [374.6487555, 300.46605049, 62.7211886, 143.37280077],
                  [356.9636221, 335.11317491, 63.32256707, 120.57341125],
                  [356.89338394, 380.4686058, 63.32256707, 166.23726267],
                  [421.35415783, 491.95500436, 65.48684982, 117.60770359],
                  [419.97649172, 577.47862099, 66.1129904, 186.37917084],
                  [587.8079089, 345.19022191, 83.94706666, 50.0676438],
                  [534.4244445, 337.80602422, 87.6010702, 58.17565535],
                  [530.82246561, 315.20978728, 86.59336002, 125.74667988],
                  [477.45455019, 344.59162787, 78.6387945, 131.29074606],
                  [377.91634243, 332.35298536, 65.74973384, 62.53764366],
                  [328.99031521, 306.60503502, 62.35581368, 68.2135617],
                  [305.47410283, 271.54668107, 58.6860077, 71.46277003],
                  [318.80177521, 251.14440069, 57.8628551, 73.23241683],
                  [362.83323993, 180.01953193, 55.48837716, 98.408876],
                  [399.27252285, 111.86603595, 54.53116082, 155.86637707],
                  [455.7140112, 78.21726152, 56.77629347, 139.7228954],
                  [494.72521666, 120.92144919, 59.06445632, 138.04400566],
                  [498.71108871, 199.74715893, 55.98345738, 154.33317045],
                  [497.01887288, 208.90411078, 52.91975057, 87.64500841],
                  [467.21349242, 261.49383836, 53.33151039, 59.70184252],
                  [426.84656201, 323.44942031, 53.82610891, 53.42309894],
                  [372.63314399, 407.65829747, 54.79507277, 57.92357033],
                  [325.66962699, 527.25789118, 61.84467212, 66.96261447],
                  [253.57860714, 557.08971225, 67.36948493, 82.01053286],
                  [167.97562323, 593.28351359, 67.36948493, 86.90654463],
                  [169.75773915, 581.13573285, 68.27525174, 88.95448274],
                  [218.78033932, 566.08048014, 69.42569769, 114.00706941],
                  [278.87165507, 545.90955982, 70.19430176, 177.74591416],
                  [331.22751664, 772.99750408, 78.76374483, 210.12252692],
                  [598.48240576, 1247.02900026, 83.44535637, 122.72611784],
                  [622.93513908, 360.79272443, 131.12108907, 95.89206172],
                  [650.10949847, 343.33110477, 131.23238929, 93.05830162],
                  [662.6205427, 304.45411748, 132.03878218, 92.55623328],
                  [660.07379133, 206.14457912, 133.68597533, 88.10066685],
                  [656.14383141, 118.22667846, 134.91488984, 74.4153672],
                  [653.61063333, 108.08542918, 135.75765172, 65.34187019],
                  [643.11651161, 116.25415046, 135.75765172, 64.43715931],
                  [635.3334951, 120.31270714, 135.41174247, 66.23148798],
                  [631.74163776, 152.29632916, 134.9584751, 79.99092136],
                  [626.22211714, 223.5662933, 135.39323284, 87.57710888],
                  [620.72374529, 310.23625171, 134.78289023, 104.92266199],
                  [600.29696216, 411.12974593, 137.58062182, 141.6220545],
                  [595.29417909, 446.80607091, 139.66811331, 148.06243498],
                  [674.43682571, 281.80072204, 162.78530915, 153.49546207],
                  [584.98124756, 299.15288316, 160.02940355, 100.43080952],
                  [605.38556929, 324.37788149, 159.88264446, 85.79130201],
                  [592.97886978, 345.17958732, 159.88264446, 76.88914098],
                  [566.3312988, 393.86742693, 161.17881374, 69.64974874],
                  [579.88046182, 420.3410639, 162.01793111, 67.139612],
                  [616.81531069, 403.87083022, 162.13839767, 60.08244336],
                  [684.22620427, 353.52740739, 164.76203294, 57.58630962],
                  [751.94413481, 268.16445514, 167.57722846, 59.3759421],
                  [791.82526639, 210.94893339, 169.13955776, 55.86526201],
                  [809.27536221, 185.07817774, 170.37162322, 56.12184846],
                  [808.68915382, 156.52184352, 172.01043573, 60.55955746],
                  [792.75879686, 115.89282495, 172.45790066, 63.99578111],
                  [773.86390761, 99.81978762, 172.32988714, 67.97381849],
                  [761.24360588, 125.86591079, 172.32988714, 77.4934836],
                  [762.60709904, 189.61990929, 172.27083328, 78.46566128],
                  [768.35394839, 269.95589918, 173.42199976, 83.01233342],
                  [770.69242365, 363.02406945, 175.08894882, 86.60359043],
                  [763.48450282, 526.09870962, 183.96528885, 79.25803044],
                  [726.12225038, 552.96609299, 192.49477915, 109.84038419],
                  [725.29588962, 490.98332711, 200.71434926, 177.26434357],
                  [569.65358737, 429.27858216, 206.54809876, 108.71690577],
                  [529.57346693, 386.03096055, 207.51695714, 67.30302278],
                  [505.55795909, 390.63302472, 205.48260267, 62.07541281],
                  [426.51710399, 408.61716496, 204.18689356, 56.71375495],
                  [340.79222409, 419.56766737, 204.77008449, 61.17309458],
                  [260.30983462, 412.77547165, 204.77863048, 65.16738064],
                  [249.4030072, 401.41316309, 204.77863048, 70.28362185],
                  [281.18486357, 394.26094151, 204.63940847, 73.04306949],
                  [305.89643264, 387.18580488, 203.71987507, 97.60220284],
                  [437.69502153, 373.60852757, 204.4139122, 111.47942355],
                  [663.75653249, 353.70013462, 209.34384992, 134.3551177],
                  [851.66055445, 483.84727962, 212.06381115, 140.22926763],
                  [580.50042851, 389.18958346, 237.33105043, 195.44527847],
                  [613.72325756, 363.66132166, 236.64380406, 170.68471666],
                  [644.65051578, 356.62935942, 237.18830072, 160.94039269],
                  [663.71479379, 343.11663833, 237.14284198, 147.01601954],
                  [684.61602377, 357.12811077, 237.6852751, 195.59629342]])

user = 1
train = data[user, 0][:15]
test_gen = data[user, 0][15:]
test_for = data[user, 1][:]

hid, rmse = estimate_hidden_signature(train, 4)

plot_signatures(hid)

for i, sig in enumerate(train):
    print "trn {}:".format(i), score_rmse(hidden_signature=hid, rmse=rmse, signature=sig)
for i, sig in enumerate(test_gen):
    print "gen {}:".format(i), score_rmse(hidden_signature=hid, rmse=rmse, signature=sig)
for i, sig in enumerate(test_for):
    print "for {}:".format(i), score_rmse(hidden_signature=hid, rmse=rmse, signature=sig)
